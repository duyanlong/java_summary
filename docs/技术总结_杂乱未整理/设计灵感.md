技术分享app思路
需求
目标
要做什么

发展历程
技术视角：
存储过程处理数据
配套调度机制（crontab java-quartz）

mr  hive  
痛点：慢
配套调度

百花争鸣
tez impala pig presto

spark
痛点：交互差、底层直接暴露操作、客户端单点故障、平台化能力弱
也不是真正的

flink（效率高，但技术总要有先驱者）
批流一体

平台化建设道路（以饭店日常运营为例）
crontab + hive
厨师长管理采购、厨房调配，单人请假就停业了
优点：可快速实现  
缺点：单机、重试机制、任务依赖、可维护性差

分布式调度系统 + hive
给厨师长陪副手，流程太固化，炒完必须有传菜员拿来盘子我才盛菜，不然就等着，有苏联种树的意思
优点：稳定、以上缺点已解决
缺点：基于MR，性能低

分布式调度系统 + hive server2 
优点：较上面方式快一些
缺点：本质不变效率低，同时不利于企业化发展

分布式调度 + spark-sql
优点：性能高
缺点：底层暴露

分布式调度 + spark-thriftserver
优点：更快
缺点：不利于资源管理，yarn

web ui + 分布式调度 + spark client

web ui + 分布式调度 + flink client

加入ui背景后产生
titan1.0
设计思考
架构设计
缺点：系统捡漏、门槛高

titan2.0
设计思考
架构设计
缺点：系统繁杂、用户体验差、陷入技术陷阱

技术扩展：
服务化思考之道
apache livy
apache zeepplin
spark jobserver

hive on spark
spark on hive
spark thrift+hive beelin
spark sql + hive metastore

spark 运行模式
on yarn 
on mesos
on k8s
standlone


未来展望
on k8s
flink 批流一体
自定义代码


---网上spark server实现方案
https://bbs.csdn.net/topics/392184197
大概是：
1、编写一个Spark Driver，我们称之为SparkJobServer，部署模式是Yarn client，打开DynamicAllocation特性，即会根据实际需要动态申请Executor。然后启动的时候，在ZK的某个路径下，创建一个PERSISTENT_SEQUENTIAL类型节点（参见：http://blog.csdn.net/heyutao007/article/details/38741207），得到自己的一个ID，然后在新建的这个节点下，设置自身的ip，Socket端口，以及负载值（当前有多少个SQL在跑）等信息。启动一个Socket Server，监听上面说的端口，接收SQL请求，优化SQL，然后通过SQLContext.sql执行，负载值+1，执行完成后-1，结果放在请求报文定义的hdfs目录上，并在redis设置对应的key value。另外有个细节就是利用ShutdownHook，在Driver意外退出的时候，删除ZK上自身信息节点，实现自动下线。这个SparkJobServer会在不同机器启动多个，以实现HA和负载均衡。
2、Web后端接收前端传来的SQL，通过UUID生成一个请求Key，在ZK指定路径下，找到目前可用且负载值最小的SparkJobServer，向它发送指定格式的TCP/IP报文。然后把key返回给前端。
3、前端拿着这个key去轮询另一个rest接口，这个rest接口直接去查询redis，如果拿到值，就是SparkJobServer跑出来放在HDFS上的结果文件路径，直接读取这个文件，返回给前端。如果拿不到值，前端定时轮询直到取到值。
4、另外会有一个后台服务去监控SparkJobServer的状况。可以手工启动或下线SparkJobServer。
我们这个方案是经过数据日增量10T，日即席查询数1w+考验的架构。可以根据自身需求修改。

### 问题
现在需要思考数据计算和数据同步使用server+client模式，还是直接client模式
#### client模式：         
* 优点            
1、结构简单，直接由调度系统调度即可，任务配置信息和调度信息完全交由调度系统和平台管理 

* 缺点    
1、部署分散需要分散维护，增加维护难度     
2、只做计算和传输工作，对于执行过程中的一些细节如监控和日志等信息无法和调用方互通    
3、依赖调度系统无法单独使用      

#### server+client模式    
* 优点    
1、统一维护管理，方便维护   
2、脱离调度可单独为业务系统服务    
3、精细化管理作业，收集管理作业的运行信息可随时监控、查看   
4、自身实现分布式架构，可实现负载均衡和平台的高可用性 

* 缺点        
1、架构复杂、实现难度系数高，出现错误容易影响业务   
2、开发周期长 

### AirFlow
* 优点        
1、作为开源的调度系统相对比较成熟，内部实现了不同的调度方式、调度周期、dag流程、监控、报警等可直接通过编码实现，和作业逻辑代码无缝对接       
2、分布式设计，可以灵活扩容      

* 缺点        
1、需要遵守airflow开发规范，将业务逻辑编写Airflow DAG才可以使用，需要python开发经验，门槛较高     
2、作业调度都是通过代码实现，对于平台化建设，配置作业是负担，比如在平台配置作业后需要再开发dag或者参照建军的方式开发一套配置流程，无法实现平台自动化        
3、以DAG工作流为最小单位，无法重跑工作流中的单个作业        
4、无法批量执行作业，批量跑作业需要开发dag自己实现，并且开发的批量执行是针对单个作业的而不是整个dag工作流；Airflow自带的回填数据命令尝试无法执行      

